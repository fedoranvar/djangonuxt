import { defineNuxtRouteMiddleware, useRuntimeConfig, useNuxtApp } from "#app";
import useSession from "../composables/useSession.mjs";
export default defineNuxtRouteMiddleware((to) => {
  if (to.meta.auth === false) {
    return;
  }
  const { status, signIn } = useSession();
  if (status.value === "authenticated") {
    return;
  }
  const authConfig = useRuntimeConfig().public.auth;
  const nuxtApp = useNuxtApp();
  const router = nuxtApp.$router;
  if (authConfig.globalMiddlewareOptions.allow404WithoutAuth) {
    const matchedRoute = router.getRoutes().find((route) => route.path === to.path);
    if (!matchedRoute) {
      return;
    }
  }
  return signIn(void 0, { callbackUrl: to.path, error: "SessionRequired" });
});
